{% extends "base.html" %}
{% load cms_tags sekizai_tags %}

{% block base_content %}
{# Intro text can be configured in Django-CMS #}
{% placeholder base_content %}

<div id="ants_atlas">
	<h1>Atlas</h1>
	
	<div class="well">
		<form id="search" class="form-inline">
			<label for="species_id">Species: </label>

			<select id="species_id">
				{% for g in genus %}
				<optgroup label="{{ g.name }}">
					{% for s in g.species_set.all %}
					<option value="{{ s.pk }}">{{ s.scientificname }}</option>
					{% endfor %}
				</optgroup>
				{% endfor %}
			</select>

			<label for="color_code">Color: </label>
			<input type="text" name="color_code" id="color_code" class="colorpicker input-mini"/>
			<button type="submit" class="btn btn-success" /><i class="icon-search icon-white"></i> Search</button>
		</form>
	</div>

	<div class="row">
		<div class="span3">
			<h2>Layers</h2>
			<table class="table table-striped" id="search_list">
			</table>
		</div>

		<div class="span9" id="map"></div>
	</div>

		{# Templates #}
		<script type="text/html" id="layerListEntry">
			// TR added by view
			<td><span class="badge badge-info"><%= occurrences_count %></span></td>
			<td><%= species_name %></td>
			<td><i class="icon-trash remove"></i></td>
		</script>

	</div>

	{% addtoblock "js" %}<script type="text/javascript" src="{{ STATIC_URL }}ants_atlas/js/underscore-min.js"></script>{% endaddtoblock %}
	{% addtoblock "js" %}<script type="text/javascript" src="{{ STATIC_URL }}ants_atlas/js/backbone-min.js"></script>{% endaddtoblock %}

	{% addtoblock "js" %}<script type="text/javascript" src="{{ STATIC_URL }}js/backbone-tastypie.js"></script>{% endaddtoblock %}

	{# Use version https://github.com/xaguilars/bootstrap-colorpicker because the original one has issues and is not mainained anymore. #}
	{% addtoblock "js" %}<script type="text/javascript" src="{{ STATIC_URL }}ants_atlas/js/bootstrap-colorpicker.js"></script>{% endaddtoblock %}
	{% addtoblock "js" %}<script type="text/javascript" src="{{ STATIC_URL }}ants_atlas/js/ants_atlas.js"></script>{% endaddtoblock %}
	{% addtoblock "js" %}

	{% addtoblock "css" %}
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />
	<!--[if lte IE 8]><link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.ie.css" /><![endif]-->
	{% endaddtoblock %}

	{% addtoblock "css" %}
	<link rel="stylesheet" href="{{ STATIC_URL }}ants_atlas/css/bootstrap-colorpicker.css" />
	{% endaddtoblock %}

	{% addtoblock "css" %}
	<link rel="stylesheet" href="{{ STATIC_URL }}ants_atlas/css/ants_atlas.css" />
	{% endaddtoblock %}

	{% addtoblock "js" %}
	<script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>
	{% endaddtoblock %}

	{% addtoblock "js" %}
	<script src="http://maps.google.com/maps/api/js?v=3.2&sensor=false"></script>
	{% endaddtoblock %}	

	{% addtoblock "js" %}
	<script src="{{ STATIC_URL }}ants_atlas/js/leaflet-plugins/Google.js"></script>
	{% endaddtoblock %}

	<script type="text/javascript">
	$(function(){
		$('.colorpicker').colorpicker()

		var app_options = {
			'squares_source_url': '{{ STATIC_URL }}ants_atlas/js/utm5.json',
			'species_api_url'	: '{% url api_dispatch_list resource_name="species" api_name="v1" %}' /* /api/v1/species/ */
		};

		var map_options = {
			overlay_color_presets: [
			'#597d1e',
			'#d62f2f',
			'#2f86d6',
			'#b85c1a'
			],

			// TODO: Move to settings.py
			cloudmade_api_key:"16534950d4b44d358c7963355dc57dc6",
			cloudmade_style_id: 998, //1930,
			initial_location: [50.6, 4.3],
			initial_zoom: 8,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
			max_zoom: 18
		};

		window._formidabel.atlas.bootstrap($('#ants_atlas'), map_options, app_options);
		
	});
	</script>

	{% endaddtoblock %}
	{% endblock %}	